<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ - ‡∏£‡πâ‡∏≤‡∏ô‡∏´‡∏°‡∏π‡∏Å‡∏£‡∏∞‡∏ó‡∏∞</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .header p {
            opacity: 0.9;
            font-size: 0.9rem;
        }

        .connection-status {
            padding: 10px;
            text-align: center;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .status-connected {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-disconnected {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status-loading {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .status-github {
            background: #e2e3e5;
            color: #383d41;
            border: 1px solid #d6d8db;
        }

        .backend-config {
            background: #f8f9fa;
            padding: 15px;
            margin: 10px;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }

        .config-input {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .tab-container {
            display: flex;
            background: #f8f9fa;
            overflow-x: auto;
        }

        .tab {
            flex: 1;
            padding: 15px 10px;
            text-align: center;
            cursor: pointer;
            border: none;
            background: transparent;
            font-size: 0.9rem;
            transition: all 0.3s;
            white-space: nowrap;
            min-width: 80px;
        }

        .tab.active {
            background: white;
            color: #ee5a24;
            font-weight: bold;
            border-bottom: 3px solid #ee5a24;
        }

        .tab:hover {
            background: #e9ecef;
        }

        .content {
            padding: 20px;
            min-height: 400px;
        }

        .add-item-form {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .form-row.full {
            grid-template-columns: 1fr;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: bold;
            margin-bottom: 5px;
            color: #495057;
            font-size: 0.9rem;
        }

        input, select {
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #ee5a24;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s;
            text-align: center;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-primary {
            background: linear-gradient(135deg, #ee5a24, #ff6b6b);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(238, 90, 36, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #00d2d3, #54a0ff);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff3838, #ff6b6b);
            color: white;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 0.8rem;
            margin: 2px;
        }

        .inventory-table {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-top: 20px;
        }

        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        th {
            background: linear-gradient(135deg, #ee5a24, #ff6b6b);
            color: white;
            padding: 12px 8px;
            text-align: center;
            font-weight: bold;
            white-space: nowrap;
        }

        td {
            padding: 10px 8px;
            text-align: center;
            border-bottom: 1px solid #e9ecef;
            vertical-align: middle;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .category-cell {
            background: #e9ecef;
            font-size: 0.8rem;
            padding: 4px 8px;
            border-radius: 4px;
        }

        .category-‡∏´‡∏°‡∏π {
            background: #ffe8e8;
            color: #c92a2a;
        }

        .category-‡∏ó‡∏∞‡πÄ‡∏• {
            background: #e3f2fd;
            color: #1976d2;
        }

        .category-‡∏Ç‡∏≠‡∏á‡∏ó‡∏≤‡∏ô‡πÄ‡∏•‡πà‡∏ô {
            background: #e8f5e8;
            color: #388e3c;
        }

        .category-‡∏ô‡πâ‡∏≥‡∏à‡∏¥‡πâ‡∏° {
            background: #fff3e0;
            color: #f57c00;
        }

        .stock-input {
            width: 60px;
            padding: 4px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
        }

        .stock-display {
            font-weight: bold;
            padding: 4px 8px;
            border-radius: 4px;
            min-width: 40px;
        }

        .stock-initial {
            background: #e3f2fd;
            color: #1976d2;
        }

        .stock-used {
            background: #fff3e0;
            color: #f57c00;
        }

        .stock-remaining {
            background: #e8f5e8;
            color: #388e3c;
        }

        .stock-remaining.low {
            background: #ffebee;
            color: #c62828;
        }

        .action-buttons {
            display: flex;
            gap: 4px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn-icon {
            padding: 6px 8px;
            font-size: 0.8rem;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-edit {
            background: #17a2b8;
            color: white;
        }

        .btn-delete {
            background: #dc3545;
            color: white;
        }

        .btn-reset {
            background: #6c757d;
            color: white;
        }

        .btn-update {
            background: #28a745;
            color: white;
        }

        .btn-icon:hover {
            transform: scale(1.05);
            opacity: 0.9;
        }

        .table-summary {
            background: #f8f9fa;
            padding: 15px;
            border-top: 2px solid #dee2e6;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            text-align: center;
        }

        .summary-item {
            background: white;
            padding: 10px;
            border-radius: 6px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .summary-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: #ee5a24;
        }

        .summary-label {
            font-size: 0.8rem;
            color: #666;
            margin-top: 4px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 400px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .daily-summary {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .summary-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .summary-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ee5a24;
        }

        .summary-label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }

        .user-info {
            background: #e3f2fd;
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            th, td {
                padding: 8px 4px;
                font-size: 0.8rem;
            }
            
            .stock-input {
                width: 50px;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .btn-icon {
                font-size: 0.7rem;
                padding: 4px 6px;
            }
            
            .tab {
                font-size: 0.8rem;
                padding: 12px 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üê∑ ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h1>
            <p>‡∏£‡πâ‡∏≤‡∏ô‡∏´‡∏°‡∏π‡∏Å‡∏£‡∏∞‡∏ó‡∏∞‡∏ä‡∏±‡πà‡∏á‡∏Å‡∏¥‡πÇ‡∏•</p>
        </div>

        <div id="connectionStatus" class="connection-status status-github">
            üåê ‡πÇ‡∏´‡∏°‡∏î GitHub Pages - ‡πÉ‡∏ä‡πâ Local Storage
        </div>

        <div class="backend-config" id="backendConfig" style="display: none;">
            <h4>üîß ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Backend API</h4>
            <p style="margin-bottom: 10px; font-size: 0.9rem;">‡∏´‡∏≤‡∏Å‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ Backend Server ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏£‡∏≠‡∏Å URL ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á:</p>
            <input type="text" id="apiUrl" class="config-input" placeholder="http://localhost:3000/api" value="">
            <div style="display: flex; gap: 10px; margin-top: 10px;">
                <button class="btn btn-primary btn-small" onclick="connectToBackend()">‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Backend</button>
                <button class="btn btn-small" onclick="toggleBackendConfig()">‡∏ã‡πà‡∏≠‡∏ô</button>
            </div>
        </div>

        <div class="tab-container">
            <button class="tab active" onclick="showTab('inventory')">üì¶ ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
            <button class="tab" onclick="showTab('daily')">üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</button>
            <button class="tab" onclick="showTab('report')">üìã ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</button>
            <button class="tab" onclick="showTab('settings')">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</button>
        </div>

        <div class="content">
            <div class="user-info">
                <strong>‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:</strong> <span id="currentUser">‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏</span> | 
                <strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</strong> <span id="currentDate"></span>
                <button class="btn btn-small" onclick="changeUser()" style="margin-left: 10px;">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</button>
                <button class="btn btn-small" onclick="clearLocalStorage()" style="margin-left: 5px; background: #dc3545; color: white;">‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡πâ‡∏≠‡∏á‡∏ñ‡∏¥‡πà‡∏ô</button>
                <button class="btn btn-small" onclick="toggleBackendConfig()" style="margin-left: 5px; background: #007bff; color: white;">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Backend</button>
            </div>

            <div id="inventory" class="tab-content active">
                <div class="add-item-form">
                    <h3>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
                            <select id="newItemCategory">
                                <option value="‡∏´‡∏°‡∏π">üê∑ ‡∏´‡∏°‡∏π</option>
                                <option value="‡∏ó‡∏∞‡πÄ‡∏•">ü¶ê ‡∏ó‡∏∞‡πÄ‡∏•</option>
                                <option value="‡∏Ç‡∏≠‡∏á‡∏ó‡∏≤‡∏ô‡πÄ‡∏•‡πà‡∏ô">ü•¢ ‡∏Ç‡∏≠‡∏á‡∏ó‡∏≤‡∏ô‡πÄ‡∏•‡πà‡∏ô</option>
                                <option value="‡∏ô‡πâ‡∏≥‡∏à‡∏¥‡πâ‡∏°">ü•Ñ ‡∏ô‡πâ‡∏≥‡∏à‡∏¥‡πâ‡∏°</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
                            <input type="text" id="newItemName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>‡∏£‡∏≤‡∏Ñ‡∏≤ (‡∏ö‡∏≤‡∏ó/‡∏Å‡∏Å.)</label>
                            <input type="number" id="newItemPrice" placeholder="0">
                        </div>
                        <div class="form-group">
                            <label>‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (‡∏Å‡∏Å.)</label>
                            <input type="number" id="newItemStock" placeholder="0" step="0.1">
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="addItem()" style="width: 100%;" id="addItemBtn">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
                </div>

                <div class="category-nav">
                    <button class="btn btn-small" onclick="showCategory('‡∏´‡∏°‡∏π')">üê∑ ‡∏´‡∏°‡∏π</button>
                    <button class="btn btn-small" onclick="showCategory('‡∏ó‡∏∞‡πÄ‡∏•')">ü¶ê ‡∏ó‡∏∞‡πÄ‡∏•</button>
                    <button class="btn btn-small" onclick="showCategory('‡∏Ç‡∏≠‡∏á‡∏ó‡∏≤‡∏ô‡πÄ‡∏•‡πà‡∏ô')">ü•¢ ‡∏Ç‡∏≠‡∏á‡∏ó‡∏≤‡∏ô‡πÄ‡∏•‡πà‡∏ô</button>
                    <button class="btn btn-small" onclick="showCategory('‡∏ô‡πâ‡∏≥‡∏à‡∏¥‡πâ‡∏°')">ü•Ñ ‡∏ô‡πâ‡∏≥‡∏à‡∏¥‡πâ‡∏°</button>
                    <button class="btn btn-small" onclick="showCategory('all')">üìã ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                </div>

                <div id="itemsContainer" style="margin-top: 20px;"></div>
            </div>

            <div id="daily" class="tab-content" style="display: none;">
                <div class="daily-summary">
                    <h3>‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h3>
                    <div class="summary-grid">
                        <div class="summary-card">
                            <div class="summary-number" id="totalItems">0</div>
                            <div class="summary-label">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>
                        </div>
                        <div class="summary-card">
                            <div class="summary-number" id="totalValue">0</div>
                            <div class="summary-label">‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ (‡∏ö‡∏≤‡∏ó)</div>
                        </div>
                        <div class="summary-card">
                            <div class="summary-number" id="usedValue">0</div>
                            <div class="summary-label">‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ (‡∏ö‡∏≤‡∏ó)</div>
                        </div>
                    </div>
                    <button class="btn btn-success" onclick="saveDailySummary()" style="width: 100%;" id="saveSummaryBtn">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏£‡∏∏‡∏õ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô</button>
                </div>

                <div class="inventory-table" style="margin-top: 20px;">
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</th>
                                    <th>‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</th>
                                    <th>‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏Å‡∏Å.</th>
                                    <th>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</th>
                                    <th>‡πÉ‡∏ä‡πâ‡πÑ‡∏õ</th>
                                    <th>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th>
                                    <th>‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th>
                                </tr>
                            </thead>
                            <tbody id="dailySummaryTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="report" class="tab-content" style="display: none;">
                <h3>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô</h3>
                <div id="reportContainer"></div>
                <button class="btn btn-primary" onclick="exportReport()" style="width: 100%; margin-top: 20px;">‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</button>
            </div>

            <div id="settings" class="tab-content" style="display: none;">
                <div class="daily-summary">
                    <h3>‚öôÔ∏è ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</h3>
                    
                    <h4 style="margin-top: 20px;">üîó ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Backend</h4>
                    <div class="form-group" style="margin: 10px 0;">
                        <label>Backend API URL:</label>
                        <input type="text" id="settingsApiUrl" class="config-input" placeholder="http://localhost:3000/api">
                    </div>
                    <button class="btn btn-primary btn-small" onclick="saveSettings()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</button>
                    <button class="btn btn-success btn-small" onclick="testApiConnection()">‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</button>
                    
                    <h4 style="margin-top: 20px;">üìÅ ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h4>
                    <div style="margin: 10px 0;">
                        <button class="btn btn-primary btn-small" onclick="exportData()">‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                        <button class="btn btn-success btn-small" onclick="importData()">‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                        <input type="file" id="importFile" accept=".json" style="display: none;" onchange="handleFileImport(event)">
                    </div>
                    
                    <h4 style="margin-top: 20px;">üóÑÔ∏è ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h4>
                    <div id="dataStatus" style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 10px 0;">
                        <p><strong>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤:</strong> <span id="statusItemCount">0</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
                        <p><strong>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô:</strong> <span id="statusReportCount">0</span> ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</p>
                        <p><strong>‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î:</strong> <span id="statusLastUpdate">‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏</span></p>
                        <p><strong>‡πÇ‡∏´‡∏°‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô:</strong> <span id="statusMode">Local Storage</span></p>
                    </div>

                    <h4 style="margin-top: 20px;">‚ÑπÔ∏è ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö</h4>
                    <div style="background: #e7f3ff; padding: 15px; border-radius: 8px; margin: 10px 0;">
                        <p><strong>‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô:</strong> 2.0.0 (MySQL Integration)</p>
                        <p><strong>‡πÇ‡∏´‡∏°‡∏î:</strong> GitHub Pages Compatible</p>
                        <p><strong>‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÇ‡∏î‡∏¢:</strong> ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</p>
                        <p style="margin-top: 10px; font-size: 0.9rem;">
                            ‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡πÅ‡∏ö‡∏ö Local Storage (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö GitHub Pages) 
                            ‡πÅ‡∏•‡∏∞ MySQL Database (‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ Backend Server)
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="editModal" class="modal">
        <div class="modal-content">
            <h3>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
            <div class="form-group">
                <label>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
                <input type="text" id="editItemName">
            </div>
            <div class="form-group">
                <label>‡∏£‡∏≤‡∏Ñ‡∏≤ (‡∏ö‡∏≤‡∏ó/‡∏Å‡∏Å.)</label>
                <input type="number" id="editItemPrice">
            </div>
            <div class="form-group">
                <label>‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (‡∏Å‡∏Å.)</label>
                <input type="number" id="editItemStock" step="0.1">
            </div>
            <div style="display: flex; gap: 10px; margin-top: 15px;">
                <button class="btn btn-success" onclick="saveEdit()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                <button class="btn btn-danger" onclick="closeModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let inventory = [];
        let dailyReports = [];
        let currentUser = '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
        let editingItemId = null;
        let currentCategory = 'all';
        let dbConnected = false;
        let API_BASE_URL = '';

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            loadSettings();
            updateCurrentDate();
            loadData();
        });

        // Settings management
        function loadSettings() {
            const savedApiUrl = localStorage.getItem('apiUrl');
            if (savedApiUrl) {
                API_BASE_URL = savedApiUrl;
                document.getElementById('settingsApiUrl').value = savedApiUrl;
                document.getElementById('apiUrl').value = savedApiUrl;
            }
        }

        function saveSettings() {
            const apiUrl = document.getElementById('settingsApiUrl').value.trim();
            if (apiUrl) {
                API_BASE_URL = apiUrl;
                localStorage.setItem('apiUrl', apiUrl);
                document.getElementById('apiUrl').value = apiUrl;
                alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                testApiConnection();
            } else {
                localStorage.removeItem('apiUrl');
                API_BASE_URL = '';
                updateConnectionStatus('github', '‡πÇ‡∏´‡∏°‡∏î GitHub Pages - ‡πÉ‡∏ä‡πâ Local Storage');
            }
        }

        function toggleBackendConfig() {
            const config = document.getElementById('backendConfig');
            config.style.display = config.style.display === 'none' ? 'block' : 'none';
        }

        async function connectToBackend() {
            const apiUrl = document.getElementById('apiUrl').value.trim();
            if (!apiUrl) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà Backend API URL');
                return;
            }
            
            API_BASE_URL = apiUrl;
            localStorage.setItem('apiUrl', apiUrl);
            document.getElementById('settingsApiUrl').value = apiUrl;
            
            const success = await testConnection();
            if (success) {
                toggleBackendConfig();
                loadData();
            }
        }

        // Connection status management
        function updateConnectionStatus(status, message) {
            const statusEl = document.getElementById('connectionStatus');
            statusEl.className = `connection-status status-${status}`;
            
            const icons = {
                connected: '‚úÖ',
                disconnected: '‚ùå',
                loading: 'üîÑ',
                github: 'üåê'
            };
            
            statusEl.textContent = `${icons[status]} ${message}`;
            dbConnected = (status === 'connected');
            
            updateStatusDisplay();
        }

        function updateStatusDisplay() {
            const statusMode = document.getElementById('statusMode');
            if (statusMode) {
                statusMode.textContent = dbConnected ? 'MySQL Database' : 'Local Storage';
            }
        }

        // Test database connection
        async function testConnection() {
            if (!API_BASE_URL) {
                updateConnectionStatus('github', '‡πÇ‡∏´‡∏°‡∏î GitHub Pages - ‡πÉ‡∏ä‡πâ Local Storage');
                return false;
            }

            updateConnectionStatus('loading', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...');
            
            try {
                const response = await fetch(`${API_BASE_URL}/test-connection`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    updateConnectionStatus('connected', '‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                    return true;
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                console.error('Connection test failed:', error);
                updateConnectionStatus('disconnected', `‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${error.message}`);
                return false;
            }
        }

        async function testApiConnection() {
            await testConnection();
        }

        // MySQL API Functions
        async function saveToMySQL(data) {
            if (!dbConnected || !API_BASE_URL) {
                saveToLocalStorage(data);
                return false;
            }

            try {
                const inventoryResponse = await fetch(`${API_BASE_URL}/inventory/sync`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        items: inventory,
                        user: currentUser
                    })
                });

                if (!inventoryResponse.ok) {
                    throw new Error(`Inventory sync failed: ${inventoryResponse.statusText}`);
                }

                console.log('‚úÖ Data synced to MySQL successfully');
                
                saveToLocalStorage(data);
                return true;
                
            } catch (error) {
                console.error('‚ùå MySQL save failed:', error);
                updateConnectionStatus('disconnected', `‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${error.message}`);
                
                saveToLocalStorage(data);
                return false;
            }
        }

        async function loadFromMySQL() {
            if (!dbConnected || !API_BASE_URL) {
                return loadFromLocalStorage();
            }

            try {
                const response = await fetch(`${API_BASE_URL}/inventory`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error(`Load failed: ${response.statusText}`);
                }

                const data = await response.json();
                
                if (data.items && Array.isArray(data.items)) {
                    inventory = data.items.map(item => ({
                        id: item.id,
                        category: item.category,
                        name: item.name,
                        price: parseFloat(item.price),
                        initialStock: parseFloat(item.initial_stock),
                        usedStock: parseFloat(item.used_stock),
                        remainingStock: parseFloat(item.remaining_stock),
                        createdBy: item.created_by,
                        createdDate: item.created_date
                    }));
                    
                    console.log('‚úÖ Data loaded from MySQL:', inventory.length, 'items');
                    
                    saveToLocalStorage({
                        inventory: inventory,
                        dailyReports: dailyReports,
                        currentUser: currentUser
                    });
                    
                    return true;
                } else {
                    console.log('No data found in MySQL, using local storage');
                    return loadFromLocalStorage();
                }
                
            } catch (error) {
                console.error('‚ùå MySQL load failed:', error);
                updateConnectionStatus('disconnected', `‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${error.message}`);
                
                return loadFromLocalStorage();
            }
        }

        async function saveDailyReportToMySQL(reportData) {
            if (!dbConnected || !API_BASE_URL) {
                console.warn('Database not connected, cannot save daily report to MySQL');
                return false;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/daily-reports`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        date: reportData.date,
                        user: reportData.user,
                        totalItems: reportData.totalItems,
                        totalValue: reportData.totalValue,
                        usedValue: reportData.usedValue,
                        items: reportData.items
                    })
                });

                if (!response.ok) {
                    throw new Error(`Daily report save failed: ${response.statusText}`);
                }

                console.log('‚úÖ Daily report saved to MySQL');
                return true;
                
            } catch (error) {
                console.error('‚ùå MySQL daily report save failed:', error);
                return false;
            }
        }

        // User management
        function changeUser() {
            const userName = prompt('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:');
            if (userName && userName.trim()) {
                currentUser = userName.trim();
                document.getElementById('currentUser').textContent = currentUser;
                saveData();
            }
        }

        function updateCurrentDate() {
            const now = new Date();
            const dateStr = now.toLocaleDateString('th-TH', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            document.getElementById('currentDate').textContent = dateStr;
        }

        function clearLocalStorage() {
            if (confirm('‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡πâ‡∏≠‡∏á‡∏ñ‡∏¥‡πà‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î? ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ')) {
                localStorage.clear();
                inventory = [];
                dailyReports = [];
                currentUser = '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
                alert('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡πâ‡∏≠‡∏á‡∏ñ‡∏¥‡πà‡∏ô‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡∏≠‡∏¢‡∏π‡πà)');
                location.reload();
            }
        }

        // Tab management
        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.style.display = 'none');
            
            document.querySelector(`[onclick="showTab('${tabName}')"]`).classList.add('active');
            document.getElementById(tabName).style.display = 'block';
            
            if (tabName === 'daily') {
                updateDailySummary();
                updateDailySummaryTable();
            } else if (tabName === 'report') {
                displayReports();
            } else if (tabName === 'settings') {
                updateSettingsTab();
            }
        }

        function updateSettingsTab() {
            document.getElementById('statusItemCount').textContent = inventory.length;
            document.getElementById('statusReportCount').textContent = dailyReports.length;
            
            const lastUpdate = localStorage.getItem('lastUpdate');
            if (lastUpdate) {
                document.getElementById('statusLastUpdate').textContent = new Date(lastUpdate).toLocaleString('th-TH');
            }
        }

        // Category management
        function showCategory(category) {
            currentCategory = category;
            displayItems();
        }

        // Item management
        async function addItem() {
            const category = document.getElementById('newItemCategory').value;
            const name = document.getElementById('newItemName').value;
            const price = parseFloat(document.getElementById('newItemPrice').value) || 0;
            const stock = parseFloat(document.getElementById('newItemStock').value) || 0;

            if (!name.trim()) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤');
                return;
            }

            const newItem = {
                id: Date.now(),
                category: category,
                name: name.trim(),
                price: price,
                initialStock: stock,
                usedStock: 0,
                remainingStock: stock,
                createdBy: currentUser,
                createdDate: new Date().toISOString()
            };

            inventory.push(newItem);
            
            document.getElementById('newItemName').value = '';
            document.getElementById('newItemPrice').value = '';
            document.getElementById('newItemStock').value = '';

            const success = await saveData();
            displayItems();
            
            if (dbConnected && success) {
                alert('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß (‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)');
            } else {
                alert('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß (‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á)');
            }
        }

        function editItem(id) {
            const item = inventory.find(i => i.id === id);
            if (!item) return;

            editingItemId = id;
            document.getElementById('editItemName').value = item.name;
            document.getElementById('editItemPrice').value = item.price;
            document.getElementById('editItemStock').value = item.initialStock;
            document.getElementById('editModal').style.display = 'block';
        }

        async function saveEdit() {
            if (!editingItemId) return;

            const item = inventory.find(i => i.id === editingItemId);
            if (!item) return;

            const newName = document.getElementById('editItemName').value;
            const newPrice = parseFloat(document.getElementById('editItemPrice').value) || 0;
            const newStock = parseFloat(document.getElementById('editItemStock').value) || 0;

            if (!newName.trim()) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤');
                return;
            }

            item.name = newName.trim();
            item.price = newPrice;
            item.initialStock = newStock;
            item.remainingStock = newStock - item.usedStock;
            if (item.remainingStock < 0) item.remainingStock = 0;

            closeModal();
            
            const success = await saveData();
            displayItems();
            
            if (dbConnected && success) {
                alert('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß (‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)');
            } else {
                alert('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß (‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á)');
            }
        }

        async function deleteItem(id) {
            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                inventory = inventory.filter(i => i.id !== id);
                
                const success = await saveData();
                displayItems();
                
                if (dbConnected && success) {
                    alert('‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß (‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)');
                } else {
                    alert('‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß (‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á)');
                }
            }
        }

        async function updateUsage(id) {
            const item = inventory.find(i => i.id === id);
            if (!item) return;

            const usageInput = document.getElementById(`usage-${id}`);
            const usedAmount = parseFloat(usageInput.value) || 0;
            
            if (usedAmount < 0) {
                alert('‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î‡∏•‡∏ö');
                usageInput.value = item.usedStock;
                return;
            }

            if (usedAmount > item.initialStock) {
                alert('‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÑ‡∏î‡πâ');
                usageInput.value = item.usedStock;
                return;
            }

            item.usedStock = usedAmount;
            item.remainingStock = item.initialStock - usedAmount;

            await saveData();
            displayItems();
        }

        async function resetStock(id) {
            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                const item = inventory.find(i => i.id === id);
                if (item) {
                    item.usedStock = 0;
                    item.remainingStock = item.initialStock;
                    
                    const success = await saveData();
                    displayItems();
                    
                    if (dbConnected && success) {
                        alert('‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß (‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)');
                    } else {
                        alert('‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß (‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á)');
                    }
                }
            }
        }

        function closeModal() {
            document.getElementById('editModal').style.display = 'none';
            editingItemId = null;
        }

        // Display functions
        function displayItems() {
            const container = document.getElementById('itemsContainer');
            let filteredItems = inventory;

            if (currentCategory !== 'all') {
                filteredItems = inventory.filter(item => item.category === currentCategory);
            }

            if (filteredItems.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏´‡∏°‡∏ß‡∏î‡∏ô‡∏µ‡πâ</p>';
                return;
            }

            const totalValue = filteredItems.reduce((sum, item) => sum + (item.remainingStock * item.price), 0);
            const usedValue = filteredItems.reduce((sum, item) => sum + (item.usedStock * item.price), 0);
            const totalInitial = filteredItems.reduce((sum, item) => sum + (item.initialStock * item.price), 0);

            const html = `
                <div class="inventory-table">
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</th>
                                    <th>‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</th>
                                    <th>‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏Å‡∏Å.</th>
                                    <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ</th>
                                    <th>‡πÉ‡∏ä‡πâ‡πÑ‡∏õ</th>
                                    <th>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th>
                                    <th>‡∏£‡∏∞‡∏ö‡∏∏‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ</th>
                                    <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${filteredItems.map(item => `
                                    <tr>
                                        <td>
                                            <span class="category-cell category-${item.category}">
                                                ${getCategoryIcon(item.category)} ${item.category}
                                            </span>
                                        </td>
                                        <td style="text-align: left; font-weight: bold;">${item.name}</td>
                                        <td style="color: #e74c3c; font-weight: bold;">${item.price.toLocaleString()}</td>
                                        <td>
                                            <span class="stock-display stock-initial">${item.initialStock}</span>
                                        </td>
                                        <td>
                                            <span class="stock-display stock-used">${item.usedStock}</span>
                                        </td>
                                        <td>
                                            <span class="stock-display stock-remaining ${item.remainingStock <= 0.5 && item.remainingStock > 0 ? 'low' : (item.remainingStock === 0 ? 'low' : '')}">${item.remainingStock}</span>
                                        </td>
                                        <td>
                                            <div style="display: flex; gap: 4px; align-items: center; justify-content: center;">
                                                <input type="number" id="usage-${item.id}" class="stock-input" 
                                                       placeholder="0" step="0.1" value="${item.usedStock}">
                                                <button class="btn-icon btn-update" onclick="updateUsage(${item.id})" title="‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó">‚úì</button>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="action-buttons">
                                                <button class="btn-icon btn-edit" onclick="editItem(${item.id})" title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç">‚úèÔ∏è</button>
                                                <button class="btn-icon btn-reset" onclick="resetStock(${item.id})" title="‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï">üîÑ</button>
                                                <button class="btn-icon btn-delete" onclick="deleteItem(${item.id})" title="‡∏•‡∏ö">üóëÔ∏è</button>
                                            </div>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                    <div class="table-summary">
                        <div class="summary-item">
                            <div class="summary-value">${filteredItems.length}</div>
                            <div class="summary-label">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-value">${totalInitial.toLocaleString()}</div>
                            <div class="summary-label">‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (‡∏ö‡∏≤‡∏ó)</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-value">${usedValue.toLocaleString()}</div>
                            <div class="summary-label">‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ (‡∏ö‡∏≤‡∏ó)</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-value">${totalValue.toLocaleString()}</div>
                            <div class="summary-label">‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ (‡∏ö‡∏≤‡∏ó)</div>
                        </div>
                    </div>
                </div>
            `;

            container.innerHTML = html;
        }

        function getCategoryIcon(category) {
            const icons = {
                '‡∏´‡∏°‡∏π': 'üê∑',
                '‡∏ó‡∏∞‡πÄ‡∏•': 'ü¶ê',
                '‡∏Ç‡∏≠‡∏á‡∏ó‡∏≤‡∏ô‡πÄ‡∏•‡πà‡∏ô': 'ü•¢',
                '‡∏ô‡πâ‡∏≥‡∏à‡∏¥‡πâ‡∏°': 'ü•Ñ'
            };
            return icons[category] || 'üì¶';
        }

        // Daily summary functions
        function updateDailySummary() {
            const totalItems = inventory.length;
            const totalValue = inventory.reduce((sum, item) => sum + (item.remainingStock * item.price), 0);
            const usedValue = inventory.reduce((sum, item) => sum + (item.usedStock * item.price), 0);

            document.getElementById('totalItems').textContent = totalItems.toLocaleString();
            document.getElementById('totalValue').textContent = totalValue.toLocaleString();
            document.getElementById('usedValue').textContent = usedValue.toLocaleString();
            
            updateDailySummaryTable();
        }

        function updateDailySummaryTable() {
            const tbody = document.getElementById('dailySummaryTableBody');
            if (!tbody) return;
            
            const html = inventory.map(item => {
                const itemValue = item.remainingStock * item.price;
                return `
                    <tr>
                        <td>
                            <span class="category-cell category-${item.category}">
                                ${getCategoryIcon(item.category)} ${item.category}
                            </span>
                        </td>
                        <td style="text-align: left; font-weight: bold;">${item.name}</td>
                        <td style="color: #e74c3c; font-weight: bold;">${item.price.toLocaleString()}</td>
                        <td>
                            <span class="stock-display stock-initial">${item.initialStock}</span>
                        </td>
                        <td>
                            <span class="stock-display stock-used">${item.usedStock}</span>
                        </td>
                        <td>
                            <span class="stock-display stock-remaining ${item.remainingStock <= 0.5 && item.remainingStock > 0 ? 'low' : (item.remainingStock === 0 ? 'low' : '')}">${item.remainingStock}</span>
                        </td>
                        <td style="color: #28a745; font-weight: bold;">${itemValue.toLocaleString()}</td>
                    </tr>
                `;
            }).join('');
            
            tbody.innerHTML = html;
        }

        async function saveDailySummary() {
            const today = new Date().toISOString().split('T')[0];
            const existingReportIndex = dailyReports.findIndex(r => r.date === today);

            const summary = {
                date: today,
                user: currentUser,
                totalItems: inventory.length,
                totalValue: inventory.reduce((sum, item) => sum + (item.remainingStock * item.price), 0),
                usedValue: inventory.reduce((sum, item) => sum + (item.usedStock * item.price), 0),
                items: inventory.map(item => ({ 
                    id: item.id,
                    name: item.name,
                    category: item.category,
                    price: item.price,
                    initialStock: item.initialStock,
                    usedStock: item.usedStock,
                    remainingStock: item.remainingStock
                })),
                timestamp: new Date().toISOString()
            };

            if (existingReportIndex !== -1) {
                dailyReports[existingReportIndex] = summary;
            } else {
                dailyReports.push(summary);
            }

            let success = false;
            if (dbConnected) {
                success = await saveDailyReportToMySQL(summary);
            }

            saveToLocalStorage({
                inventory: inventory,
                dailyReports: dailyReports,
                currentUser: currentUser
            });

            if (dbConnected && success) {
                alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏£‡∏∏‡∏õ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß (‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)');
            } else {
                alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏£‡∏∏‡∏õ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß (‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á)');
            }

            displayReports();
        }

        // Report functions
        function displayReports() {
            const container = document.getElementById('reportContainer');
            
            if (dailyReports.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</p>';
                return;
            }

            const sortedReports = [...dailyReports].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            const html = sortedReports.map(report => `
                <div class="item-card" style="margin-bottom: 15px; background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                    <div class="item-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <div class="item-name" style="font-weight: bold; font-size: 1.1rem;">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${new Date(report.date).toLocaleDateString('th-TH')}</div>
                        <div class="item-price" style="font-size: 0.9rem; color: #666;">‡πÇ‡∏î‡∏¢: ${report.user}</div>
                    </div>
                    <div class="item-stock" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 10px; text-align: center;">
                        <div class="stock-info initial">
                            <div style="font-weight: bold; color: #ee5a24;">${report.totalItems}</div>
                            <div style="font-size: 0.8rem; color: #495057;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>
                        </div>
                        <div class="stock-info used">
                            <div style="font-weight: bold; color: #f57c00;">${report.usedValue.toLocaleString()}</div>
                            <div style="font-size: 0.8rem; color: #495057;">‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ</div>
                        </div>
                        <div class="stock-info remaining">
                            <div style="font-weight: bold; color: #388e3c;">${report.totalValue.toLocaleString()}</div>
                            <div style="font-size: 0.8rem; color: #495057;">‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</div>
                        </div>
                    </div>
                    <div style="margin-top: 15px; text-align: center;">
                         <button class="btn btn-small btn-info" onclick="viewDailyReportDetails('${report.date}')">‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</button>
                    </div>
                </div>
            `).join('');

            container.innerHTML = html;
        }

        function viewDailyReportDetails(date) {
            const report = dailyReports.find(r => r.date === date);
            if (!report) {
                alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πâ');
                return;
            }

            let detailsHtml = `
                <h4>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${new Date(report.date).toLocaleDateString('th-TH')}</h4>
                <p><strong>‡∏ú‡∏π‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å:</strong> ${report.user}</p>
                <p><strong>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠:</strong> ${new Date(report.timestamp).toLocaleString('th-TH')}</p>
                <p><strong>‡∏™‡∏£‡∏∏‡∏õ:</strong></p>
                <ul>
                    <li>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${report.totalItems}</li>
                    <li>‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏£‡∏ß‡∏°: ${report.totalValue.toLocaleString()} ‡∏ö‡∏≤‡∏ó</li>
                    <li>‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÑ‡∏õ‡∏£‡∏ß‡∏°: ${report.usedValue.toLocaleString()} ‡∏ö‡∏≤‡∏ó</li>
                </ul>
                <h5 style="margin-top: 15px;">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤:</h5>
                <div class="inventory-table">
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</th>
                                    <th>‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</th>
                                    <th>‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏Å‡∏Å.</th>
                                    <th>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</th>
                                    <th>‡πÉ‡∏ä‡πâ‡πÑ‡∏õ</th>
                                    <th>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${report.items.map(item => `
                                    <tr>
                                        <td>
                                            <span class="category-cell category-${item.category}">
                                                ${getCategoryIcon(item.category)} ${item.category}
                                            </span>
                                        </td>
                                        <td style="text-align: left;">${item.name}</td>
                                        <td>${item.price.toLocaleString()}</td>
                                        <td>${item.initialStock}</td>
                                        <td>${item.usedStock}</td>
                                        <td>${item.remainingStock}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
                <button class="btn btn-danger" onclick="closeModal()" style="margin-top: 15px;">‡∏õ‡∏¥‡∏î</button>
            `;

            const modal = document.getElementById('editModal');
            const modalContent = modal.querySelector('.modal-content');
            
            modalContent.dataset.originalHtml = modalContent.innerHTML; 
            modalContent.innerHTML = detailsHtml;
            modal.style.display = 'block';
        }

        const originalCloseModal = closeModal;
        closeModal = function() {
            const modal = document.getElementById('editModal');
            const modalContent = modal.querySelector('.modal-content');
            if (modalContent.dataset.originalHtml) {
                modalContent.innerHTML = modalContent.dataset.originalHtml;
                delete modalContent.dataset.originalHtml;
            }
            originalCloseModal();
        };

        function exportReport() {
            if (dailyReports.length === 0) {
                alert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å');
                return;
            }

            const csvContent = generateCSV();
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function generateCSV() {
            let csv = '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà,‡∏ú‡∏π‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å,‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤,‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠,‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ\n';
            
            dailyReports.forEach(report => {
                csv += `${new Date(report.date).toLocaleDateString('th-TH')},${report.user},${report.totalItems},${report.totalValue},${report.usedValue}\n`;
            });
            
            return csv;
        }

        // Data management functions
        function exportData() {
            const dataToExport = {
                inventory: inventory,
                dailyReports: dailyReports,
                currentUser: currentUser,
                exportDate: new Date().toISOString(),
                version: '2.0.0'
            };

            const dataStr = JSON.stringify(dataToExport, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `inventory_backup_${new Date().toISOString().split('T')[0]}.json`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function importData() {
            document.getElementById('importFile').click();
        }

        function handleFileImport(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    if (importedData.inventory && Array.isArray(importedData.inventory)) {
                        if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà')) {
                            inventory = importedData.inventory;
                            dailyReports = importedData.dailyReports || [];
                            currentUser = importedData.currentUser || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
                            
                            document.getElementById('currentUser').textContent = currentUser;
                            
                            saveData();
                            displayItems();
                            updateDailySummary();
                            displayReports();
                            
                            alert(`‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß: ${inventory.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤, ${dailyReports.length} ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô`);
                        }
                    } else {
                        alert('‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
                    }
                } catch (error) {
                    alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå: ' + error.message);
                }
            };
            reader.readAsText(file);
            
            // Reset file input
            event.target.value = '';
        }

        // Data persistence functions
        function saveToLocalStorage(dataToSave) {
            try {
                dataToSave.lastUpdate = new Date().toISOString();
                localStorage.setItem('inventoryData', JSON.stringify(dataToSave));
                localStorage.setItem('lastUpdate', dataToSave.lastUpdate);
                console.log('üíæ Data saved to local storage.');
            } catch (e) {
                console.error('Error saving to local storage:', e);
            }
        }

        function loadFromLocalStorage() {
            try {
                const storedData = localStorage.getItem('inventoryData');
                if (storedData) {
                    const parsedData = JSON.parse(storedData);
                    console.log('‚úÖ Data loaded from local storage.');
                    return parsedData;
                }
                console.log('Local storage empty or no inventory data found.');
                return null;
            } catch (e) {
                console.error('Error loading from local storage:', e);
                return null;
            }
        }

        async function saveData() {
            const dataToSave = {
                inventory: inventory,
                dailyReports: dailyReports,
                currentUser: currentUser,
                lastUpdated: new Date().toISOString()
            };

            if (dbConnected && API_BASE_URL) {
                return await saveToMySQL(dataToSave);
            } else {
                saveToLocalStorage(dataToSave);
                return true; // Always return true for local storage
            }
        }

        async function loadData() {
            console.log('=== Starting data load process ===');
            
            if (API_BASE_URL) {
                const connected = await testConnection();
                
                if (connected) {
                    const success = await loadFromMySQL();
                    if (!success) {
                        console.log('‚ö†Ô∏è MySQL loading failed, checking local storage...');
                        const localData = loadFromLocalStorage();
                        if (localData && localData.inventory) {
                            inventory = localData.inventory;
                            dailyReports = localData.dailyReports || [];
                            currentUser = localData.currentUser || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
                            console.log('‚úÖ Loaded data from local storage.');
                        } else {
                            console.log('‚ö†Ô∏è Local storage also empty, using sample data.');
                            loadSampleData();
                        }
                    }
                } else {
                    console.log('‚ö†Ô∏è Database connection failed, checking local storage...');
                    const localData = loadFromLocalStorage();
                    if (localData && localData.inventory) {
                        inventory = localData.inventory;
                        dailyReports = localData.dailyReports || [];
                        currentUser = localData.currentUser || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
                        console.log('‚úÖ Loaded data from local storage.');
                    } else {
                        console.log('‚ö†Ô∏è Local storage also empty, using sample data.');
                        loadSampleData();
                    }
                }
            } else {
                // No API URL configured, use local storage only
                const localData = loadFromLocalStorage();
                if (localData && localData.inventory) {
                    inventory = localData.inventory;
                    dailyReports = localData.dailyReports || [];
                    currentUser = localData.currentUser || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
                    console.log('‚úÖ Loaded data from local storage (GitHub Pages mode).');
                } else {
                    console.log('‚ö†Ô∏è Local storage empty, using sample data.');
                    loadSampleData();
                }
            }
            
            document.getElementById('currentUser').textContent = currentUser;
            displayItems();
            updateDailySummary();
            displayReports();
        }

        function loadSampleData() {
            if (inventory.length === 0) {
                inventory = [
                    {
                        id: 1,
                        category: '‡∏´‡∏°‡∏π',
                        name: '‡∏´‡∏°‡∏π‡∏™‡∏≤‡∏°‡∏ä‡∏±‡πâ‡∏ô',
                        price: 280,
                        initialStock: 5.0,
                        usedStock: 1.5,
                        remainingStock: 3.5,
                        createdBy: '‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£',
                        createdDate: new Date().toISOString()
                    },
                    {
                        id: 2,
                        category: '‡∏ó‡∏∞‡πÄ‡∏•',
                        name: '‡∏Å‡∏∏‡πâ‡∏á‡∏Ç‡∏≤‡∏ß',
                        price: 350,
                        initialStock: 2.0,
                        usedStock: 0.5,
                        remainingStock: 1.5,
                        createdBy: '‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£',
                        createdDate: new Date().toISOString()
                    },
                    {
                        id: 3,
                        category: '‡∏Ç‡∏≠‡∏á‡∏ó‡∏≤‡∏ô‡πÄ‡∏•‡πà‡∏ô',
                        name: '‡∏•‡∏π‡∏Å‡∏ä‡∏¥‡πâ‡∏ô‡∏õ‡∏•‡∏≤',
                        price: 120,
                        initialStock: 1.0,
                        usedStock: 0.2,
                        remainingStock: 0.8,
                        createdBy: '‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£',
                        createdDate: new Date().toISOString()
                    },
                    {
                        id: 4,
                        category: '‡∏ô‡πâ‡∏≥‡∏à‡∏¥‡πâ‡∏°',
                        name: '‡∏ô‡πâ‡∏≥‡∏à‡∏¥‡πâ‡∏°‡∏£‡∏™‡πÄ‡∏õ‡∏£‡∏µ‡πâ‡∏¢‡∏ß',
                        price: 80,
                        initialStock: 0.5,
                        usedStock: 0.1,
                        remainingStock: 0.4,
                        createdBy: '‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£',
                        createdDate: new Date().toISOString()
                    }
                ];
                console.log('Sample data loaded.');
                
                // Save sample data to local storage
                saveToLocalStorage({
                    inventory: inventory,
                    dailyReports: dailyReports,
                    currentUser: currentUser
                });
            }
        }

        // Event listeners
        window.onclick = function(event) {
            const modal = document.getElementById('editModal');
            if (event.target === modal) {
                closeModal();
            }
        }

        document.addEventListener('keypress', function(event) {
            if (event.key === 'Enter' && event.target.tagName === 'INPUT') {
                event.preventDefault();
                
                if (event.target.id.startsWith('usage-')) {
                    const itemId = event.target.id.split('-')[1];
                    updateUsage(parseInt(itemId));
                } else if (event.target.closest('.add-item-form')) {
                    addItem();
                } else if (event.target.closest('.modal-content')) {
                    if (event.target.id === 'editItemName' || event.target.id === 'editItemPrice' || event.target.id === 'editItemStock') {
                        saveEdit();
                    }
                } else if (event.target.id === 'settingsApiUrl') {
                    saveSettings();
                } else if (event.target.id === 'apiUrl') {
                    connectToBackend();
                }
            }
        });

        // Auto-save every 5 minutes
        setInterval(function() {
            if (inventory.length > 0) {
                saveData();
                console.log('Auto-saved data');
            }
        }, 5 * 60 * 1000); // 5 minutes
    </script>
</body>
</html>