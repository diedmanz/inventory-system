<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ - ‡∏£‡πâ‡∏≤‡∏ô‡∏´‡∏°‡∏π‡∏Å‡∏£‡∏∞‡∏ó‡∏∞</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .connection-status {
            padding: 10px;
            text-align: center;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .status-connected {
            background: #d4edda;
            color: #155724;
        }

        .status-disconnected {
            background: #f8d7da;
            color: #721c24;
        }

        .status-loading {
            background: #fff3cd;
            color: #856404;
        }

        .api-config {
            background: #f8f9fa;
            padding: 15px;
            margin: 10px;
            border-radius: 8px;
            display: none;
        }

        .tab-container {
            display: flex;
            background: #f8f9fa;
            overflow-x: auto;
        }

        .tab {
            flex: 1;
            padding: 15px 10px;
            text-align: center;
            cursor: pointer;
            border: none;
            background: transparent;
            font-size: 0.9rem;
            transition: all 0.3s;
            white-space: nowrap;
            min-width: 80px;
        }

        .tab.active {
            background: white;
            color: #ee5a24;
            font-weight: bold;
            border-bottom: 3px solid #ee5a24;
        }

        .content {
            padding: 20px;
            min-height: 400px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: bold;
            margin-bottom: 5px;
            color: #495057;
        }

        input, select {
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 1rem;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s;
            text-align: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, #ee5a24, #ff6b6b);
            color: white;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 0.8rem;
            margin: 2px;
        }

        .inventory-table {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: linear-gradient(135deg, #ee5a24, #ff6b6b);
            color: white;
            padding: 12px 8px;
            text-align: center;
            font-weight: bold;
        }

        td {
            padding: 10px 8px;
            text-align: center;
            border-bottom: 1px solid #e9ecef;
        }

        .category-cell {
            background: #e9ecef;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
        }

        .stock-input {
            width: 60px;
            padding: 4px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
        }

        .btn-icon {
            padding: 6px 8px;
            font-size: 0.8rem;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            margin: 2px;
        }

        .btn-update { background: #28a745; color: white; }
        .btn-edit { background: #17a2b8; color: white; }
        .btn-reset { background: #6c757d; color: white; }
        .btn-delete { background: #dc3545; color: white; }

        .user-info {
            background: #e3f2fd;
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .summary-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .summary-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ee5a24;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            th, td {
                padding: 8px 4px;
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üê∑ ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h1>
            <p>‡∏£‡πâ‡∏≤‡∏ô‡∏´‡∏°‡∏π‡∏Å‡∏£‡∏∞‡∏ó‡∏∞‡∏ä‡∏±‡πà‡∏á‡∏Å‡∏¥‡πÇ‡∏•</p>
        </div>

        <div id="connectionStatus" class="connection-status status-loading">
            üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...
        </div>

        <div class="api-config" id="apiConfig">
            <h4>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ API Server</h4>
            <input type="text" id="apiUrl" placeholder="http://localhost:3000/api" style="width: 100%; margin: 10px 0;">
            <button class="btn btn-primary btn-small" onclick="connectAPI()">‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</button>
            <button class="btn btn-small" onclick="toggleApiConfig()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        </div>

        <div class="tab-container">
            <button class="tab active" onclick="showTab('inventory')">üì¶ ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
            <button class="tab" onclick="showTab('daily')">üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</button>
            <button class="tab" onclick="showTab('reports')">üìã ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</button>
        </div>

        <div class="content">
            <div class="user-info">
                <strong>‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:</strong> <span id="currentUser">‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏</span> | 
                <strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</strong> <span id="currentDate"></span>
                <button class="btn btn-small" onclick="changeUser()">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</button>
                <button class="btn btn-small" onclick="toggleApiConfig()" style="background: #007bff; color: white;">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ API</button>
            </div>

            <!-- ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ -->
            <div id="inventory" class="tab-content active">
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h3>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
                            <select id="newCategory">
                                <option value="‡∏´‡∏°‡∏π">üê∑ ‡∏´‡∏°‡∏π</option>
                                <option value="‡∏ó‡∏∞‡πÄ‡∏•">ü¶ê ‡∏ó‡∏∞‡πÄ‡∏•</option>
                                <option value="‡∏Ç‡∏≠‡∏á‡∏ó‡∏≤‡∏ô‡πÄ‡∏•‡πà‡∏ô">ü•¢ ‡∏Ç‡∏≠‡∏á‡∏ó‡∏≤‡∏ô‡πÄ‡∏•‡πà‡∏ô</option>
                                <option value="‡∏ô‡πâ‡∏≥‡∏à‡∏¥‡πâ‡∏°">ü•Ñ ‡∏ô‡πâ‡∏≥‡∏à‡∏¥‡πâ‡∏°</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
                            <input type="text" id="newName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>‡∏£‡∏≤‡∏Ñ‡∏≤ (‡∏ö‡∏≤‡∏ó/‡∏Å‡∏Å.)</label>
                            <input type="number" id="newPrice" placeholder="0">
                        </div>
                        <div class="form-group">
                            <label>‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (‡∏Å‡∏Å.)</label>
                            <input type="number" id="newStock" placeholder="0" step="0.1">
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="addItem()" style="width: 100%;">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
                </div>

                <div id="inventoryList"></div>
            </div>

            <!-- ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô -->
            <div id="daily" class="tab-content" style="display: none;">
                <div class="summary-grid">
                    <div class="summary-card">
                        <div class="summary-number" id="totalItems">0</div>
                        <div>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-number" id="totalValue">0</div>
                        <div>‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ (‡∏ö‡∏≤‡∏ó)</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-number" id="usedValue">0</div>
                        <div>‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ (‡∏ö‡∏≤‡∏ó)</div>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="saveDailyReport()" style="width: 100%;">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏£‡∏∏‡∏õ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô</button>
                <div id="dailyTable"></div>
            </div>

            <!-- ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô -->
            <div id="reports" class="tab-content" style="display: none;">
                <h3>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô</h3>
                <div id="reportsList"></div>
            </div>
        </div>
    </div>

    <script>
        // Simple global variables
        let API_URL = '';
        let inventory = [];
        let currentUser = '‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£';
        let connected = false;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateCurrentDate();
            loadSettings();
            testConnection();
        });

        // Settings
        function loadSettings() {
            const saved = localStorage.getItem('apiUrl');
            if (saved) {
                API_URL = saved;
                document.getElementById('apiUrl').value = saved;
                testConnection();
            }
        }

        function toggleApiConfig() {
            const config = document.getElementById('apiConfig');
            config.style.display = config.style.display === 'none' ? 'block' : 'none';
        }

        function connectAPI() {
            const url = document.getElementById('apiUrl').value.trim();
            if (url) {
                API_URL = url;
                localStorage.setItem('apiUrl', url);
                testConnection();
                toggleApiConfig();
            }
        }

        // Connection
        async function testConnection() {
            if (!API_URL) {
                updateStatus('disconnected', '‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ API - ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå');
                loadLocalData();
                return;
            }

            updateStatus('loading', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...');
            
            try {
                const response = await fetch(`${API_URL}/test-connection`);
                if (response.ok) {
                    updateStatus('connected', '‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                    connected = true;
                    loadData();
                } else {
                    throw new Error('Connection failed');
                }
            } catch (error) {
                updateStatus('disconnected', '‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à - ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå');
                connected = false;
                loadLocalData();
            }
        }

        function updateStatus(status, message) {
            const statusEl = document.getElementById('connectionStatus');
            statusEl.className = `connection-status status-${status}`;
            
            const icons = { connected: '‚úÖ', disconnected: '‚ùå', loading: 'üîÑ' };
            statusEl.textContent = `${icons[status]} ${message}`;
        }

        // Data loading
        async function loadData() {
            if (!connected) {
                loadLocalData();
                return;
            }

            try {
                const response = await fetch(`${API_URL}/inventory`);
                const data = await response.json();
                
                if (data.success && data.items) {
                    inventory = data.items.map(item => ({
                        id: item.id,
                        category: item.category,
                        name: item.name,
                        price: item.price,
                        initialStock: item.initial_stock,
                        usedStock: item.used_stock,
                        remainingStock: item.remaining_stock
                    }));
                    
                    saveLocalData();
                    displayData();
                }
            } catch (error) {
                console.error('Load error:', error);
                loadLocalData();
            }
        }

        function loadLocalData() {
            const saved = localStorage.getItem('inventoryData');
            if (saved) {
                const data = JSON.parse(saved);
                inventory = data.inventory || [];
                currentUser = data.currentUser || '‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£';
            } else {
                // Sample data
                inventory = [
                    { id: 1, category: '‡∏´‡∏°‡∏π', name: '‡∏´‡∏°‡∏π‡∏™‡∏≤‡∏°‡∏ä‡∏±‡πâ‡∏ô', price: 280, initialStock: 5, usedStock: 1.5, remainingStock: 3.5 },
                    { id: 2, category: '‡∏ó‡∏∞‡πÄ‡∏•', name: '‡∏Å‡∏∏‡πâ‡∏á‡∏Ç‡∏≤‡∏ß', price: 350, initialStock: 2, usedStock: 0.5, remainingStock: 1.5 }
                ];
            }
            displayData();
        }

        function saveLocalData() {
            localStorage.setItem('inventoryData', JSON.stringify({
                inventory: inventory,
                currentUser: currentUser,
                lastUpdate: new Date().toISOString()
            }));
        }

        // Display functions
        function displayData() {
            displayInventory();
            displaySummary();
            document.getElementById('currentUser').textContent = currentUser;
        }

        function displayInventory() {
            const container = document.getElementById('inventoryList');
            
            if (inventory.length === 0) {
                container.innerHTML = '<p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</p>';
                return;
            }

            const html = `
                <div class="inventory-table">
                    <table>
                        <thead>
                            <tr>
                                <th>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</th>
                                <th>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                                <th>‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏Å‡∏Å.</th>
                                <th>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</th>
                                <th>‡πÉ‡∏ä‡πâ‡πÑ‡∏õ</th>
                                <th>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th>
                                <th>‡∏£‡∏∞‡∏ö‡∏∏‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ</th>
                                <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${inventory.map(item => `
                                <tr>
                                    <td><span class="category-cell">${getCategoryIcon(item.category)} ${item.category}</span></td>
                                    <td style="text-align: left; font-weight: bold;">${item.name}</td>
                                    <td style="color: #e74c3c; font-weight: bold;">${item.price.toLocaleString()}</td>
                                    <td>${item.initialStock}</td>
                                    <td>${item.usedStock}</td>
                                    <td>${item.remainingStock}</td>
                                    <td>
                                        <input type="number" id="usage-${item.id}" class="stock-input" 
                                               value="${item.usedStock}" step="0.1">
                                        <button class="btn-icon btn-update" onclick="updateUsage(${item.id})">‚úì</button>
                                    </td>
                                    <td>
                                        <button class="btn-icon btn-reset" onclick="resetStock(${item.id})">üîÑ</button>
                                        <button class="btn-icon btn-delete" onclick="deleteItem(${item.id})">üóëÔ∏è</button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            
            container.innerHTML = html;
        }

        function displaySummary() {
            const totalItems = inventory.length;
            const totalValue = inventory.reduce((sum, item) => sum + (item.remainingStock * item.price), 0);
            const usedValue = inventory.reduce((sum, item) => sum + (item.usedStock * item.price), 0);

            document.getElementById('totalItems').textContent = totalItems;
            document.getElementById('totalValue').textContent = totalValue.toLocaleString();
            document.getElementById('usedValue').textContent = usedValue.toLocaleString();

            // Display daily table
            const dailyHtml = `
                <div class="inventory-table" style="margin-top: 20px;">
                    <table>
                        <thead>
                            <tr>
                                <th>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</th>
                                <th>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                                <th>‡∏£‡∏≤‡∏Ñ‡∏≤</th>
                                <th>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</th>
                                <th>‡πÉ‡∏ä‡πâ‡πÑ‡∏õ</th>
                                <th>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th>
                                <th>‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${inventory.map(item => `
                                <tr>
                                    <td><span class="category-cell">${getCategoryIcon(item.category)} ${item.category}</span></td>
                                    <td style="text-align: left;">${item.name}</td>
                                    <td>${item.price.toLocaleString()}</td>
                                    <td>${item.initialStock}</td>
                                    <td>${item.usedStock}</td>
                                    <td>${item.remainingStock}</td>
                                    <td style="color: #28a745; font-weight: bold;">${(item.remainingStock * item.price).toLocaleString()}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            
            document.getElementById('dailyTable').innerHTML = dailyHtml;
        }

        function getCategoryIcon(category) {
            const icons = {
                '‡∏´‡∏°‡∏π': 'üê∑',
                '‡∏ó‡∏∞‡πÄ‡∏•': 'ü¶ê', 
                '‡∏Ç‡∏≠‡∏á‡∏ó‡∏≤‡∏ô‡πÄ‡∏•‡πà‡∏ô': 'ü•¢',
                '‡∏ô‡πâ‡∏≥‡∏à‡∏¥‡πâ‡∏°': 'ü•Ñ'
            };
            return icons[category] || 'üì¶';
        }

        // Item operations
        async function addItem() {
            const category = document.getElementById('newCategory').value;
            const name = document.getElementById('newName').value.trim();
            const price = parseFloat(document.getElementById('newPrice').value) || 0;
            const stock = parseFloat(document.getElementById('newStock').value) || 0;

            if (!name) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤');
                return;
            }

            const newItem = {
                id: Date.now(),
                category: category,
                name: name,
                price: price,
                initialStock: stock,
                usedStock: 0,
                remainingStock: stock
            };

            if (connected) {
                try {
                    const response = await fetch(`${API_URL}/inventory/item`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            category: category,
                            name: name,
                            price: price,
                            initial_stock: stock,
                            created_by: currentUser
                        })
                    });

                    if (response.ok) {
                        loadData();
                        clearForm();
                        alert('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                        return;
                    }
                } catch (error) {
                    console.error('Add item error:', error);
                }
            }

            // Fallback to local storage
            inventory.push(newItem);
            saveLocalData();
            displayData();
            clearForm();
            alert('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß (‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á)');
        }

        async function updateUsage(id) {
            const item = inventory.find(i => i.id == id);
            const input = document.getElementById(`usage-${id}`);
            const usedAmount = parseFloat(input.value) || 0;

            if (usedAmount < 0 || usedAmount > item.initialStock) {
                alert('‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
                input.value = item.usedStock;
                return;
            }

            if (connected) {
                try {
                    const response = await fetch(`${API_URL}/inventory/item/${id}/usage`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ used_stock: usedAmount })
                    });

                    if (response.ok) {
                        loadData();
                        return;
                    }
                } catch (error) {
                    console.error('Update usage error:', error);
                }
            }

            // Fallback to local storage
            item.usedStock = usedAmount;
            item.remainingStock = item.initialStock - usedAmount;
            saveLocalData();
            displayData();
        }

        async function resetStock(id) {
            if (!confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) return;

            if (connected) {
                try {
                    const response = await fetch(`${API_URL}/inventory/item/${id}/reset`, {
                        method: 'PUT'
                    });

                    if (response.ok) {
                        loadData();
                        alert('‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                        return;
                    }
                } catch (error) {
                    console.error('Reset stock error:', error);
                }
            }

            // Fallback to local storage
            const item = inventory.find(i => i.id == id);
            item.usedStock = 0;
            item.remainingStock = item.initialStock;
            saveLocalData();
            displayData();
            alert('‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
        }

        async function deleteItem(id) {
            if (!confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) return;

            if (connected) {
                try {
                    const response = await fetch(`${API_URL}/inventory/item/${id}`, {
                        method: 'DELETE'
                    });

                    if (response.ok) {
                        loadData();
                        alert('‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                        return;
                    }
                } catch (error) {
                    console.error('Delete item error:', error);
                }
            }

            // Fallback to local storage
            inventory = inventory.filter(i => i.id != id);
            saveLocalData();
            displayData();
            alert('‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
        }

        async function saveDailyReport() {
            const today = new Date().toISOString().split('T')[0];
            const totalValue = inventory.reduce((sum, item) => sum + (item.remainingStock * item.price), 0);
            const usedValue = inventory.reduce((sum, item) => sum + (item.usedStock * item.price), 0);
            const initialValue = inventory.reduce((sum, item) => sum + (item.initialStock * item.price), 0);

            const reportData = {
                date: today,
                user: currentUser,
                totalItems: inventory.length,
                totalValue: totalValue,
                usedValue: usedValue,
                initialValue: initialValue,
                items: inventory
            };

            if (connected) {
                try {
                    const response = await fetch(`${API_URL}/daily-reports`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(reportData)
                    });

                    if (response.ok) {
                        alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏£‡∏∏‡∏õ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß (‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)');
                        return;
                    }
                } catch (error) {
                    console.error('Save report error:', error);
                }
            }

            alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏£‡∏∏‡∏õ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß (‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á)');
        }

        // Helper functions
        function clearForm() {
            document.getElementById('newName').value = '';
            document.getElementById('newPrice').value = '';
            document.getElementById('newStock').value = '';
        }

        function changeUser() {
            const userName = prompt('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:');
            if (userName && userName.trim()) {
                currentUser = userName.trim();
                saveLocalData();
                displayData();
            }
        }

        function updateCurrentDate() {
            const now = new Date();
            const dateStr = now.toLocaleDateString('th-TH', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            document.getElementById('currentDate').textContent = dateStr;
        }

        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.style.display = 'none');
            
            document.querySelector(`[onclick="showTab('${tabName}')"]`).classList.add('active');
            document.getElementById(tabName).style.display = 'block';
            
            if (tabName === 'daily') {
                displaySummary();
            }
        }
    </script>
</body>
</html>
